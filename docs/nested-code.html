<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Bono Usu</title>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
  <meta name="description" content="Bono Usu">
  <meta name="generator" content="bookdown 0.1.14 and GitBook 2.6.7">

  <meta property="og:title" content="Bono Usu" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Bono Usu" />
  
  
  

<meta name="author" content="Jon Calder &amp; Lorenz Walthert">

  


  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="commenting-code.html">
<link rel="next" href="conditional-statements.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>


  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="code-style-guide.html"><a href="code-style-guide.html"><i class="fa fa-check"></i><b>2</b> Code style guide</a><ul>
<li class="chapter" data-level="2.1" data-path="naming.html"><a href="naming.html"><i class="fa fa-check"></i><b>2.1</b> Naming</a><ul>
<li class="chapter" data-level="2.1.1" data-path="naming.html"><a href="naming.html#naming-files"><i class="fa fa-check"></i><b>2.1.1</b> Naming files</a></li>
<li class="chapter" data-level="2.1.2" data-path="naming.html"><a href="naming.html#naming-objects"><i class="fa fa-check"></i><b>2.1.2</b> Naming objects</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="assignment.html"><a href="assignment.html"><i class="fa fa-check"></i><b>2.2</b> Assignment</a></li>
<li class="chapter" data-level="2.3" data-path="quotes.html"><a href="quotes.html"><i class="fa fa-check"></i><b>2.3</b> Quotes</a></li>
<li class="chapter" data-level="2.4" data-path="line-indentation.html"><a href="line-indentation.html"><i class="fa fa-check"></i><b>2.4</b> Line indentation</a></li>
<li class="chapter" data-level="2.5" data-path="spacing.html"><a href="spacing.html"><i class="fa fa-check"></i><b>2.5</b> Spacing</a></li>
<li class="chapter" data-level="2.6" data-path="line-length.html"><a href="line-length.html"><i class="fa fa-check"></i><b>2.6</b> Line length</a></li>
<li class="chapter" data-level="2.7" data-path="commenting-code.html"><a href="commenting-code.html"><i class="fa fa-check"></i><b>2.7</b> Commenting code</a><ul>
<li class="chapter" data-level="2.7.1" data-path="commenting-code.html"><a href="commenting-code.html#structuring-code"><i class="fa fa-check"></i><b>2.7.1</b> Structuring code</a></li>
<li class="chapter" data-level="2.7.2" data-path="commenting-code.html"><a href="commenting-code.html#explaining-code"><i class="fa fa-check"></i><b>2.7.2</b> Explaining code</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="nested-code.html"><a href="nested-code.html"><i class="fa fa-check"></i><b>2.8</b> Nested code</a><ul>
<li class="chapter" data-level="2.8.1" data-path="nested-code.html"><a href="nested-code.html#functionals"><i class="fa fa-check"></i><b>2.8.1</b> Functionals</a></li>
<li class="chapter" data-level="2.8.2" data-path="nested-code.html"><a href="nested-code.html#the-pipe-operator"><i class="fa fa-check"></i><b>2.8.2</b> The pipe operator</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="conditional-statements.html"><a href="conditional-statements.html"><i class="fa fa-check"></i><b>2.9</b> Conditional statements</a><ul>
<li class="chapter" data-level="2.9.1" data-path="conditional-statements.html"><a href="conditional-statements.html#booleans"><i class="fa fa-check"></i><b>2.9.1</b> Booleans</a></li>
<li class="chapter" data-level="2.9.2" data-path="conditional-statements.html"><a href="conditional-statements.html#simplifying-conditionals"><i class="fa fa-check"></i><b>2.9.2</b> Simplifying conditionals</a></li>
<li class="chapter" data-level="2.9.3" data-path="conditional-statements.html"><a href="conditional-statements.html#formulation-of-conditions"><i class="fa fa-check"></i><b>2.9.3</b> Formulation of conditions</a></li>
<li class="chapter" data-level="2.9.4" data-path="conditional-statements.html"><a href="conditional-statements.html#conditional-assignment"><i class="fa fa-check"></i><b>2.9.4</b> Conditional assignment</a></li>
<li class="chapter" data-level="2.9.5" data-path="conditional-statements.html"><a href="conditional-statements.html#avoiding-redundancy"><i class="fa fa-check"></i><b>2.9.5</b> Avoiding redundancy</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="argument-specification.html"><a href="argument-specification.html"><i class="fa fa-check"></i><b>2.10</b> Argument specification</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="workflow-collaboration.html"><a href="workflow-collaboration.html"><i class="fa fa-check"></i><b>3</b> Workflow &amp; collaboration</a></li>
<li class="chapter" data-level="4" data-path="package-development.html"><a href="package-development.html"><i class="fa fa-check"></i><b>4</b> Package development</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bono Usu</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="nested-code" class="section level2">
<h2><span class="header-section-number">2.8</span> Nested code</h2>
<p>Line indentation is great, but if you hit the third level of nesting, you should maybe consider an approach that does not require so many sub-levels of code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># bad</span>
if (x ==<span class="st"> </span><span class="ot">TRUE</span>){
  for (i in <span class="dv">4</span>:<span class="dv">13</span>){
    if (z[i] ==<span class="st"> </span><span class="ot">TRUE</span>){
      <span class="co"># ...</span>
    } else if (t ==<span class="st"> </span><span class="ot">TRUE</span>){
<span class="co"># .... </span></code></pre></div>
<p>In many cases, you can use functions to avoid nesting, in certain cases, the specific functions you want to use are functionals or the pipe. In more advanced settings, you might want to resort to <em>recursive functions</em>.<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a></p>
<div id="functionals" class="section level3">
<h3><span class="header-section-number">2.8.1</span> Functionals</h3>
<p>A great way to get rid of nested code related to for loops is to replace them with functionals. However, not all nested code can be replaced with functionals. We do not want to dive into that further here, since Hadley Wickham’s book <a href="http://adv-r.had.co.nz/Functionals.html">Advanced R</a> covers the material quite nicely. However, let us just quickly discuss an example in the context of good style. The task is to return the data types of each column in the data frame <code>mtcars</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># good</span>
<span class="kw">lapply</span>(mtcars, class)
<span class="co"># bad</span>
for (i in <span class="kw">seq_len</span>(<span class="kw">ncol</span>(mtcars))){
  <span class="kw">print</span>(<span class="kw">class</span>(mtcars[, i]))
}</code></pre></div>
<p>Note that using a functional reduced the complexity of the code dramatically, which is certainly beneficial in terms of style. Next, let us consider a functional that uses an anonymous function.<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a> One has to take a second glance to realize that the anonymous function is wrapped into another function. Also, note the expression <code>character(1)</code> that is supplied an argument of <code>vapply</code> and does not belong to the anonymous function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">as.list</span>(<span class="dv">1</span>:<span class="dv">12</span>)
<span class="kw">vapply</span>(x, function(r){
    if (r ==<span class="st"> </span><span class="dv">12</span>){
      <span class="kw">print</span>(<span class="st">&quot;this is 12&quot;</span>)
    } else {
      <span class="kw">print</span>(<span class="st">&quot;not 12&quot;</span>)
    }
  }, <span class="kw">character</span>(<span class="dv">1</span>)) </code></pre></div>
</div>
<div id="the-pipe-operator" class="section level3">
<h3><span class="header-section-number">2.8.2</span> The pipe operator</h3>
<p>On a related note, we should mention the pipe (<code>%&gt;%</code>), a function that was introduced in the <code>magrittr</code> package. It allows us to chain multiple operations instead of nesting them, which significantly improves readibilty, See the following example provided in the <a href="https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html">package vignette</a>. The following two code blocks evaluate to the same result.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># good</span>
<span class="kw">library</span>(magrittr)
car_data &lt;-<span class="st"> </span>
<span class="st">  </span>mtcars %&gt;%
<span class="st">  </span><span class="kw">subset</span>(hp &gt;<span class="st"> </span><span class="dv">100</span>) %&gt;%
<span class="st">  </span><span class="kw">aggregate</span>(. ~<span class="st"> </span>cyl, <span class="dt">data =</span> ., <span class="dt">FUN =</span> . %&gt;%<span class="st"> </span>mean %&gt;%<span class="st"> </span><span class="kw">round</span>(<span class="dv">2</span>)) %&gt;%
<span class="st">  </span><span class="kw">transform</span>(<span class="dt">kpl =</span> mpg %&gt;%<span class="st"> </span><span class="kw">multiply_by</span>(<span class="fl">0.4251</span>)) %&gt;%
<span class="st">  </span>print

<span class="co"># bad</span>
car_data &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw">transform</span>(<span class="kw">aggregate</span>(. ~<span class="st"> </span>cyl, 
                      <span class="dt">data =</span> <span class="kw">subset</span>(mtcars, hp &gt;<span class="st"> </span><span class="dv">100</span>), 
                      <span class="dt">FUN =</span> function(x) <span class="kw">round</span>(<span class="kw">mean</span>(x, <span class="dv">2</span>))), 
            <span class="dt">kpl =</span> mpg*<span class="fl">0.4251</span>)</code></pre></div>
<p>Formally, the pipe is defined as <code>x %&gt;% f(y) = f(x, y)</code>, that is, the first argument of a function following the pipe is always the output of the statement before the pipe. Hence, the verbal interpretation is best expressed with the word <em>then</em>. In the above case: take mtcars, <em>then</em> subset it with hp &gt; 100, <em>then</em>, aggregate the data, <em>then</em> transform it, and <em>then</em> return it. Also, the pipe can help you to avoid creating a lot of throwaway variables on the fly that you don’t need later on. The following two examples result in the same output.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">scope &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">10</span>
<span class="co"># good</span>
max_of_min &lt;-
<span class="st">  </span>scope %&gt;%
<span class="st">  </span><span class="kw">min</span>() %&gt;%
<span class="st">  </span><span class="kw">max</span>(<span class="dt">na.rm =</span> T)
  
<span class="co"># bad</span>
min &lt;-<span class="st"> </span><span class="kw">min</span>(scope)
max_of_min &lt;-<span class="st"> </span><span class="kw">max</span>(min, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>In this example, we only have one argument for the function <code>min</code>, which is transfered with the pipe, so there is no need to supply any argument. Of course, this example is trivial but it generalizes to more complex situations.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="4">
<li id="fn4"><p>See an example of how to compute a <a href="http://adv-r.had.co.nz/Function-operators.html">fibbonacci series</a><a href="nested-code.html#fnref4">↩</a></p></li>
<li id="fn5"><p>See an introduction to anonymous functions in <a href="http://adv-r.had.co.nz/Functional-programming.html#anonymous-functions">Advanced R</a><a href="nested-code.html#fnref5">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="commenting-code.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="conditional-statements.html" class="navigation navigation-next " aria-label="Next page""><i class="fa fa-angle-right"></i></a>

<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
